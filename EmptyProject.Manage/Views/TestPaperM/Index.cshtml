@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Admin.cshtml";
}
<script src="@Url.Content("~/Scripts/jquery.autocomplete.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.select.js")" type="text/javascript"></script>
<link type="text/css" rel="stylesheet" href="@Url.Content("~/css/jquery.autocomplete.css")" />
<style>
    .desc
    {
        display: inline;
        float: left;
        overflow: hidden;
        width: 310px;
        word-wrap: break-word;    
    }
    .TestPaperPic 
    {
    border: 1px solid #E9E9E9;
    display: inline;
    float: left;
    margin-right: 10px;
    }
</style>

<script language=javascript>
    var CategoryId = "";
    $(function () {
        LoadMainCategoryList();

        LoadTestPaper();

        $(".module_control .btn_add").click(function () {
            webLay("新建试卷", '@Url.Action("TestPaperCreate")', "max");
            return false;
        });

        $("#TestPaper .edit").live("click", function () {
            webLay("编辑试卷", '@Url.Action("TestPaperEdit")' + "?Id=" + $(this).parent().parent().attr("id"), "max");
            return false;
        });

        $("#TestPaper .comment").live("click", function () {
            webLay("查看评论", '@Url.Action("TestPaperComment")' + "?Id=" + $(this).parent().parent().attr("id"), "max");
            return false;
        });

        $("#TestPaper .del").live("click", function () {
            var Id = $(this).parent().parent().attr("id");
            yonLay("删除", "确认删除吗？", function (flag) {
                if (flag) {
                    addDo("正在处理，请稍后……");
                    $.post('@Url.Action("DeleteTestPaper")', { Id: Id }, function (data) {
                        ReLoad("TestPaper");
                    });
                }
            });
        });

        $("#TestPaper .Recommend").live("click", function () {
            var Id = $(this).parent().parent().attr("id");
            yonLay("设置", "确认修改推荐吗？", function (flag) {
                if (flag) {
                    addDo("正在处理，请稍后……");
                    $.post('@Url.Action("SetReComment")', { Id: Id }, function (data) {
                        ReLoad("TestPaper");
                    });
                }
            });
        });

        $("#SearchBut").click(function () {
            LoadTestPaper();
        });

        $("form").submit(function () {
            LoadTestPaper();
            return false;
        });

        $(".batch_delete").click(function () {
            var Ids = GetAllChecked("TestPaper");
            if (Ids != "") {
                yonLay("批量删除", "确认删除吗？", function (flag) {
                    if (flag) {
                        addDo("正在处理，请稍后……");
                        $.post('@Url.Action("DeleteTestPapers")', { Ids: Ids }, function (data) {
                            ReLoad("TestPaper");
                        });
                    }
                });
            } else {
                msgLay("错误信息", "请选择至少一项记录");
            }
            return false;
        });

        $(".batch_audit").click(function () {
            var Ids = GetAllChecked("TestPaper");
            if (Ids != "") {
                yonLay("批量审核", "确认审核吗？", function (flag) {
                    if (flag) {
                        addDo("正在处理，请稍后……");
                        $.post('@Url.Action("AuditTestPapers")', { Ids: Ids }, function (data) {
                            ReLoad("TestPaper");
                        });
                    }
                });
            } else {
                msgLay("错误信息", "请选择至少一项记录");
            }
            return false;
        });

        $(".batch_release").click(function () {
            var Ids = GetAllChecked("TestPaper");
            if (Ids != "") {
                yonLay("批量上架", "确认上架吗？", function (flag) {
                    if (flag) {
                        addDo("正在处理，请稍后……");
                        $.post('@Url.Action("ReleaseTestPapers")', { Ids: Ids }, function (data) {
                            ReLoad("TestPaper");
                        });
                    }
                });
            } else {
                msgLay("错误信息", "请选择至少一项记录");
            }
            return false;
        });

        $(".batch_not_release").click(function () {
            var Ids = GetAllChecked("TestPaper");
            if (Ids != "") {
                yonLay("批量下架", "确认下架吗？", function (flag) {
                    if (flag) {
                        addDo("正在处理，请稍后……");
                        $.post('@Url.Action("NotReleaseTestPapers")', { Ids: Ids }, function (data) {
                            ReLoad("TestPaper");
                        });
                    }
                });
            } else {
                msgLay("错误信息", "请选择至少一项记录");
            }
            return false;
        });

        $('#Keyword').bind( "input.autocomplete", function(){
            $(this).trigger('keydown.autocomplete');
        });
        $("#Keyword").autocomplete("@Url.Action("GetAutoCompleteTestPaperNames")", {
            max: 12,    //列表里的条目数
            minChars: 1,    //自动完成激活之前填入的最小字符
            scrollHeight: 300,   //提示的高度，溢出显示滚动条
            autoFill: false,    //自动填充
		    width: 200,
		    matchContains: true,
		    formatItem: formatItem,
		    formatResult: formatResult
        });

        $("#MainTestPaperCategory .ContentItem").live("click",function(){
            CategoryId = $(this).attr("id");
            LoadChildCategoryList(CategoryId);
            LoadTestPaper();
        });
        $("#ChildTestPaperCategory .ContentItem").live("click",function(){
            CategoryId = $(this).attr("id");
            $("#ChildTestPaperCategory li").removeClass("curr");
            $("#ChildTestPaperCategory li[id='" + CategoryId + "']").addClass("curr");
            LoadTestPaper();
        });
    });

	function formatItem(row) {
		return row[0];
	}
	function formatResult(row) {
		return row[0];
	}


    function LoadTestPaper() {
        var page = $("#TestPaper").attr("Page");
        if (page == null) page = 1;
        var name = $("#Keyword").val();
        var _recommend = $("#srecommend").val();
        $("#TestPaper").showLoading();
        $.post('@Url.Action("GetList")', {CategoryId:CategoryId,Name:name,Recommend:_recommend, Page:page}, function (data) {
            $("#TestPaper").html(data);
        });
    }
    function ReLoad(loadType) {
        if (loadType == "TestPaper") {
            LoadTestPaper();
        }
    }

    function GoPage(page) {
        $("#TestPaper").attr("Page", page);
        ReLoad("TestPaper");
    }

    function LoadMainCategoryList(){
        $("#MainTestPaperCategory").showLoading();
        $.post('@Url.Action("GetMainCategoryList")', {}, function (data) {
            $("#MainTestPaperCategory").html(data);
        });
    }

    function LoadChildCategoryList(parentCategoryId) {
        $("#MainTestPaperCategory li").removeClass("curr");
        $("#MainTestPaperCategory li[id='" + parentCategoryId + "']").addClass("curr");
        $("#ChildTestPaperCategory").showLoading();
        $.post('@Url.Action("GetChildCategoryList")', { ParentCategoryId: parentCategoryId }, function (data) {
            $("#ChildTestPaperCategory").html(data);
        });
    }

    $(".batch_recommond").click(function () {
        var Ids = GetAllChecked("TestPaper");
        if (Ids != "") {
            yonLay("批量设置推荐", "确认设置推荐吗？", function (flag) {
                if (flag) {
                    addDo("正在处理，请稍后……");
                    $.post('@Url.Action("BatchRecommonds")', { Ids: Ids }, function (data) {
                        ReLoad("TestPaper");
                    });
                }
            });
        } else {
            msgLay("错误信息", "请选择至少一项记录");
        }
        return false;
    });

    $(".batch_introduction").click(function () {
        var Ids = GetAllChecked("TestPaper");
        if (Ids != "") {
            yonLay("批量设置推出", "确认推出推出吗？", function (flag) {
                if (flag) {
                    addDo("正在处理，请稍后……");
                    $.post('@Url.Action("BatchIntroductions")', { Ids: Ids }, function (data) {
                        ReLoad("TestPaper");
                    });
                }
            });
        } else {
            msgLay("错误信息", "请选择至少一项记录");
        }
        return false;
    });

</script>
<div id="iframeContent">
    <div class="center-t">
        <h2 class="t_name">试卷管理</h2>
    </div>
     <div class="center-c">
        <div class="module_mod">
            <h3 class="module-t" id="MainTestPaperCategoryZoneTitle">主分类</h3>
            <ul id="MainTestPaperCategory" class="module_content module_modlist"></ul>
            <h3 class="module-t" id="ChildTestPaperCategoryZoneTitle">次分类</h3>
            <ul id="ChildTestPaperCategory" class="module_content module_modlist"></ul>
            @*<h3 class="module-t" id="TestPaperZoneTitle">试卷</h3>*@
            <div class="module_control">
                <ul class="left">
                    <li><a class="btn_warning btn_delete batch_recommond" title="批量设置推荐" href="javascript:">设置推荐</a></li>
                    <li><a class="btn_warning btn_delete batch_introduction" title="批量设置推出" href="javascript:">设置推出</a></li>
                </ul>
                <!--简单搜索开始-->
                <div class="search_simple">
                    <div class="s_form">
                        <form>
                            <input type="text" class="form_text" id="Keyword"><input type="button" title="搜索" value="搜索" id="SearchBut" class="form_button">
                        </form>
                    </div>
                </div>
                <ul class="right">
                    <li><a class="btn_set btn_add" title="新建试卷" target="_blank" href="javascript:">新建试卷</a></li>
                </ul>
            </div>
			<div id="TestPaper" class="module_content">
                
			</div>
        </div>
    </div>
</div>
