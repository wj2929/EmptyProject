@model Guid
@using EmptyProject.DomainService.Interface;
@using EmptyProject.Domain;
@using EmptyProject.Manage.Code;
@{
    IAttachmentService AttachmentService = GlobalController.IoC.Resolve<IAttachmentService>();
    AttachmentInfo Info = AttachmentService.Single(Model);
 }
<input type="file" id="fileToUpload" name="fileToUpload" onkeydown="event.returnValue=false;" onchange="javascript:return ajaxFileUpload(1);"/>
<dl class="PicList" style="width:650px">
@if (Info!=null)
{
<dd class="curr" id="@Info.Id"><img class="pic" src="@Info.Url" /><span title="默认"></span><em title="删除"></em><input type="hidden" name="AttachmentId" value="@Info.Id" /></dd>
}
    
</dl>
<script language=javascript>
    //ajax上传附件
    function ajaxFileUpload(btnid) {
        $("#loading").ajaxStart(function () {
            $(this).show();
        }).ajaxComplete(function () {
            $(this).hide();
        });
        addDo("正在上传，请稍后……", false);
        $.ajaxFileUpload
		(
			{
			    url: '/Upload_Ajax.aspx',
			    secureuri: false,
			    fileElementId: 'fileToUpload',
			    attachmentType: "BaikePic",
			    dataType: 'json',
			    success: function (data, status) {
			        removeDo();
			        if (data.error == "") {
			            $(".PicList").html('<dd id="' + data.msg.Id + '"><img class="pic" src="' + data.msg.Url + '" /><span title="默认"></span><em title="删除"></em><input type="hidden" name="AttachmentId" value="' + data.msg.Id + '" /></dd> ')
			            if ($(".PicList dd").length == 1) {
			                //当前如仅有一个附件上传，设置为默认附件
			                $.post('@Url.Action("SetDefault","Attachment")', { Id: data.msg.Id }, function () {
			                    $(".PicList dd").addClass("curr");
			                });
			            }
			        }
			    }
			}
		)
    }
</script>